<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Post Detail</title>
</head>
<body>
<div class="container">
    <h1>게시글 상세</h1>

    <!-- 게시글 정보 표시 -->
    <div class="post-detail">
        <table>
            <tr>
                <th>ID</th>
                <td th:text="${post.id}"></td>
            </tr>
            <tr>
                <th>제목</th>
                <td th:text="${post.title}"></td>
            </tr>
            <tr>
                <th>내용</th>
                <td th:text="${post.content}"></td>
            </tr>
            <tr>
                <th>작성자</th>
                <td th:text="${post.member.displayName}"></td>
            </tr>
            <tr>
                <th>작성일</th>
                <td th:text="${#temporals.format(post.created, 'yyyy-MM-dd HH:mm')}">[Formatted Date]</td>
            </tr>
            <tr>
                <th>조회수</th>
                <td th:text="${post.viewCount}"></td>
            </tr>
        </table>
    </div>

    <!-- 댓글 목록 표시 -->
    <div class="comments">
        <h2>댓글</h2>
        <ul>
            <li th:each="comment : ${comments}">
                <strong th:text="${comment.displayName}"></strong>:
                <span th:text="${comment.content}"></span>

            </li>
        </ul>
    </div>


    <!-- 댓글 작성 -->
    <!-- 댓글 작성 -->
    <div class="comment-form">
        <input type="hidden" id="postId" th:value="${post.id}">
        <textarea id="commentContent" placeholder="댓글을 입력하세요"></textarea>
        <button type="button" onclick="submitComment()">댓글 작성</button>
    </div>

    <div class="back-to-home">
        <a href="/home">목록으로 돌아가기</a>
    </div>
</div>

<script>
    function submitComment() {
        const content = document.getElementById("commentContent").value;
        const postId = document.getElementById("postId").value;


        // 로그인한 사용자 정보는 서버에서 가져와 인증된 사용자로 처리됨
        fetch("/api/comment/create", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                content: content,
                postId: postId
            })
        })
        .then(response => response.json())
        .then(data => {
            // 댓글 작성 성공 후 처리 (예: 댓글 목록 새로고침)

            location.reload(); // 페이지 새로고침 또는 댓글 목록을 동적으로 갱신할 수 있음
        })
        .catch(error => {
            console.error("Error:", error);
            alert("댓글 작성 중 오류가 발생했습니다.");
        });
    }
</script>

</body>
</html>
